## AWS Health Chime Notifier

### Description

This tool can be used to post alerts to a Chime room when AWS Health events are generated by using AWS Lambda and Amazon CloudWatch Events.

### Chime Setup

Follow these steps to configure the webhook in Chime:

1. Click the cog wheel from your Chime room 

2. Select "Manage WebHooks".

3. Create Webhook

4. Copy the webhook URL and use it as the value for the *InvestigationEventsHookURL* parameter in the Cloudformation template.

5. Create a second Webhook

5. Copy the webhook URL and use it as the value for the *OtherEventsHookURL* parameter in the Cloudformation template.

Security Note: WebHooks should be treated like passwords and should not be shared publicily. 

### AWS setup using CloudFormation

#### CloudFormation

Choose **Launch Stack** to launch the template in the US East (N. Virginia) Region in your account.
 
[![Launch AWS Health Chime Notifier](../images/cloudformation-launch-stack.png)](https://console.aws.amazon.com/cloudformation/home?region=us-east-1#/stacks/new?stackName=ChimeNotifier&templateURL=https://s3.amazonaws.com/aws-health-tools-assets/cloudformation-templates/chime-notifier.json)

The CloudFormation template requires the following parameter:

*AccountURL* - (Optional) A formatted url for a dashboard that can display information for an account. If provided the account number associated with a reported event will be a hyperlink.

*EventURL* - (Optional) A formatted url for a dashboard (such as PHD) that can display information for an event. e.g. https://phd.aws.amazon.com/phd/home?region={region}#/event-log?eventID={eventArn}&eventTab=details&layout=vertical If provided the event ARN associated with a reported event will be a hyperlink.

*InvestigationEventsHookURL* - Incoming web hook url for health events of category type investigation from Chime setup.

*OtherEventsHookURL* - Incoming web hook url for health events of all other category types from Chime setup.

Note: "Formatted url" follows the python 3 string.format() conventions, where things between curly brackets are placeholders. See the [code](LambdaFunction.py) for possible placeholder values.

### AWS Manual Setup

1. Create an IAM role for the Lambda function to use. Attach the [IAM policy](IAMPolicy) to the role in the IAM console.

Documentation on how to create an IAM policy is available here: http://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_create.html
Documentation on how to create an IAM role for Lambda is available here: http://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_create_for-service.html#roles-creatingrole-service-console

2. Create a Lambda Python function by using the [sample](LambdaFunction.py) provided and choose the IAM role created in step 1. Add an enviroment variable with key CHIMEWEBHOOK and the webhook URL from the Chime setup above as value.

More information about Lambda is available here: http://docs.aws.amazon.com/lambda/latest/dg/getting-started.html

3. Create a CloudWatch Events rule to trigger the Lambda function created in step 2 for AWS Health events.

Documentation on how to create an AWS Health CloudWatch Events rule is available here: http://docs.aws.amazon.com/health/latest/ug/cloudwatch-events-health.html

More information about AWS Health is available here: http://docs.aws.amazon.com/health/latest/ug/what-is-aws-health.html

Note that this is a just an example of how to set up automation with AWS Health, Amazon CloudWatch Events, and AWS Lambda. We recommend testing the example and tailoring it to your environment before using it in your production environment.

You can also test the Lambda function by invoking it manually and using a [sample AWS Health event data.](http://docs.aws.amazon.com/AmazonCloudWatch/latest/events/EventTypes.html#health-event-types)

### License
AWS Health Tools are licensed under the Apache 2.0 License.
